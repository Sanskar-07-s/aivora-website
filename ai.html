<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AIVORA Assistant</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="site-header">
    <div class="brand">AIVORA</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
    </nav>
  </header>

  <main class="container">
    <h2>AI Assistant</h2>

    <div class="chatbox">
      <div id="chatWindow" class="chat-window"></div>
      <div class="chat-input">
        <input id="prompt" placeholder="Ask about safety, skills, farming..." />
        <button onclick="askAI()">Send</button>
      </div>
    </div>
    <p class="muted">Runs offline fallback if no HuggingFace API key is set in <code>app.js</code>.</p>
  </main>

  <script src="app.js"></script>
  <script>
    async function askAI(){
      const q = document.getElementById('prompt').value.trim();
      if(!q) return;
      appendMessage('You', q);
      document.getElementById('prompt').value = '';
      appendMessage('AIVORA', 'Thinking...');
      try{
        const reply = await getAIReply(q);
        replaceLastAI(reply);
      }catch(e){
        replaceLastAI('Sorry, assistant failed: ' + (e.message||e));
      }
    }

    function appendMessage(name, text){
      const w = document.getElementById('chatWindow');
      const div = document.createElement('div');
      div.className = 'chat-msg';
      div.innerHTML = `<strong>${escapeHtml(name)}:</strong> <span>${escapeHtml(text)}</span>`;
      w.appendChild(div);
      w.scrollTop = w.scrollHeight;
    }

    function replaceLastAI(text){
      const w = document.getElementById('chatWindow');
      const msgs = w.querySelectorAll('.chat-msg');
      for(let i=msgs.length-1;i>=0;i--){
        if(msgs[i].innerHTML.includes('Thinking...')){
          msgs[i].innerHTML = `<strong>AIVORA:</strong> <span>${escapeHtml(text)}</span>`;
          break;
        }
      }
      w.scrollTop = w.scrollHeight;
    }
  </script>
</body>
</html>
